<html>
	<head>
		<title>Мой альбом</title>
		<meta charset="utf-8" />
		<link rel="stylesheet" href="styles/main.css" />
		<style>
			div.thumbnails {
				border:solid black thin;
				width: 150px;
				float: left;
			}
			
			div.currency {
				border:solid black thin;
				width: 500px;
				float: left;
				text-align: center;
			}

			div.thumbnails img {
				margin: 5px;
				border-radius: 50%;
				display: block;
				width: 130px;
                border: solid white thick;
			}
			
			div.large-photo {
				float: left;
			}
			
			div.large-photo img {
				width: 400px;
				margin-left: 10px;
			}
			
			div.thumbnails img:hover {
				border: solid red thick;
				cursor: pointer;
			}
			
			div.thumbnails img.selected {
				border: solid thick blue;
			}
		</style>
		<script>
			function showLarge(thumb) {
				console.log(thumb);
				var pic_name = thumb.src;
				console.log(pic_name);


				var splitted = pic_name.split(".");
				var split_len = splitted.length;
				var large_name = splitted[split_len-2] + "-large." + splitted[split_len-1];
				console.log(large_name);
				document.getElementById("large_photo").src = large_name;
                for(element of document.getElementsByClassName("thumbnails")[0].children) {
                    element.classList.remove("selected");
                }
				thumb.classList.add("selected");
			}

			function getImages() {
				var url = "api/image_service.php";
				var xhr = new XMLHttpRequest();
				xhr.open("GET", url);
				xhr.onload = function() {
					let result = xhr.responseText;

					let images = JSON.parse(result);

					let out = "";
					for(pict of images) {
						out += `<img src='${pict.url}' onclick='showLarge(this);' />`;
					}
					document.getElementById("thumbnails").innerHTML = out;
					var splitted = images[0].url.split(".")
					var split_len = splitted.length;
					var large_name = splitted[split_len-2] + "-large." + splitted[split_len-1];
					document.getElementById("large_photo").src = large_name;
					document.getElementById("large_photo").style.display = "";
				}
				xhr.send();

				var url2 = "https://www.cbr-xml-daily.ru/daily_json.js";
				var xhr2 = new XMLHttpRequest();
				xhr2.open("GET", url2);
				xhr2.onload = function() {
					let result = xhr2.responseText;
					
					let currency = JSON.parse(result);
					console.log(currency);
					console.log(currency.Valute);
					const usd = currency.Valute.USD.Value;
					const eur = currency.Valute.EUR.Value;
					const gbp = currency.Valute.GBP.Value;
					let currencies = `<p>Курс валют: USD: ${usd}, EUR: ${eur}, GBP: ${gbp}</p>`;
					document.getElementById("currency").innerHTML = currencies;
				}
				xhr2.send();
			}



		</script>
	</head>
	<body onload="getImages();">
		<div id="currency" class="currency">
			Загрузка валют...
		</div>
		<br />
		<br />
		<h1>Фотоальбом PHP</h1>
		<div class="thumbnails" id="thumbnails">
			Идет загрузка...
		</div>
		<div class="large-photo" >
			<img src="" id="large_photo" style="display: none;"/>
		</div>
	</body>
</html>