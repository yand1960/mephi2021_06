<html>
    <head>
        <title>Мой альбом</title>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="styles/main.css" />
        <style>
            div.rate {
                border:solid rgb(0, 0, 0) thin;
                margin: 5px;
                border-radius: 10px;
            }

            div.rate span{
                font-size: 20px;
                margin-left: 10px;

            }


            div.thumbnails {
                border:solid rgb(0, 0, 0) thin;
                width: 150px;
                float: left;
            }
            
            div.thumbnails img{
                margin: 5px;
                border-radius: 50%;
                display: block;
                width: 130px;
                border: solid white thick;
            }
            
            div.large-photo{
                float: left;
            }
            
            div.large-photo img{
                width:400px;
                margin-left: 10px;
            }
            
            div.thumbnails img:hover{
                border: solid red thick;
                cursor: pointer;
            }
            
            div.thumbnails img.selected{
                border: solid blue thick;
            }
            
        </style>
        <script src="scripts\jquery-3.6.0.js"></script>
        <script>
            function showLarge(thumb)
            {
                //alert("!!!!!!!!!");
                console.log(thumb);
                var pic_name=thumb.src;
                console.log(pic_name);
                var splitted = pic_name.split(".");
                console.log(splitted);
                var large_name="";
                for(var i = 0; i<splitted.length-2; i++)
                {
                    large_name += splitted[i]+".";
                }
                large_name += splitted[splitted.length-2] + "-large." + splitted[splitted.length-1];
                console.log(large_name);
                $("#large_photo").attr("src", large_name);
                $("div.thumbnails img").removeClass("selected");
                $(thumb).addClass("selected");
            }

            function getImages(){
                var url="api/image_service.php";
                //var url="http://127.0.0.1/AN01_PhotoAlbum/api/image_service.php";
                var xhr = new XMLHttpRequest();
                xhr.open("GET",url);
                xhr.onload = function (){
                    let result = xhr.responseText;
                    console.log(result);
                    let images = JSON.parse(result);
                    console.log(images);
                    let out = "";
                    // for(pict of images)
                    // {
                    //     console.log(pict.url);
                    //     out += `<img src = "${pict.url}" onclick="showLarge(this)" />`;
                        
                    // }
                    for (var i = 0; i<images.length; i++)
                    {
                        if(i==0)
                        {
                            out += `<img src = "${images[i].url}" onclick="showLarge(this)" class=selected />`;
                        }
                        else
                        {
                            out += `<img src = "${images[i].url}" onclick="showLarge(this)" />`;
                        }
                        
                    }
                    console.log(out);
                    document.getElementById("thumbnails").innerHTML=out;
                    var splitted = images[0].url.split(".");
                    var large_name = splitted[0] + "-large." + splitted[1];
                    document.getElementById("large_photo").src = large_name;
                    document.getElementById("large_photo").style.display="";
                }
                xhr.send();
            }

            function getRates(){
                var url="https://www.cbr-xml-daily.ru/daily_json.js";
                var xhr = new XMLHttpRequest();
                xhr.open("GET",url);
                xhr.onload = function (){
                    let result = xhr.responseText;
                    let rates = JSON.parse(result);
                    let ratesArr = [rates.Valute.USD, rates.Valute.EUR, rates.Valute.GBP];
                    let out = "<span> Курс валют: ";
                    ratesArr.forEach(element=> out +=`${element.Name} - ${element.Value}; `)
                    out +=`</span> `;
                    // let out = "<h3> Курс валют: </h3>";
                    // out +=`<span>${rates.Valute.USD.Name} - ${rates.Valute.USD.Value}</span> <br>`;
                    // out +=`<span>${rates.Valute.EUR.Name} - ${rates.Valute.EUR.Value}</span> <br>`;
                    // out +=`<span>${rates.Valute.GBP.Name} - ${rates.Valute.GBP.Value}</span> <br>`;
                    // console.log(out);
                    document.getElementById("rate").innerHTML=out;
                }
                xhr.send();
            }
        </script>
    </head>
    <body onload="getImages(); getRates();">
        <h1>Фотоальбом WEB API</h1>

        <div class="rate" id="rate">
            Идет загрузка курса валют....
        </div>
        
        <div class="thumbnails" id="thumbnails">
            Идет загрузка....
            
        </div>

        <div class="large-photo">
            <img src="" id="large_photo" style="display: none;"/>
        </div>
        </body>
</html>