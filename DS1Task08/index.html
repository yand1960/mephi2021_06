<html>
    <head>
        <title>DS1Task08</title>
        <meta charset="utf-8"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" rel="stylesheet"/> 
        <link rel="stylesheet" href="styles/main.css" />
    </head>
    <script src="scripts/jquery-3.6.0.js"></script>
    <script src="scripts/buttons.js"></script>

    <body>
        <h1>Измерение расстояний на изображении</h1>
        <div class="container">
            <input type="file" id="fileReader"class="btn"/>
            <button id="btn" class="btn btn-outline-secondary">Загрузить изображение</button>
            <button id="btn-cancel" class="btn btn-outline-secondary">Начать заново</button>
            <button id="btn-cancel-last" class="btn btn-outline-secondary">Отменить последнее измерение</button>
        </div>
        
        <div class="container d-block">
            <div class="index" id ='point1'></div>
            <div class="index" id ='point2'></div>
            <img id="img"/>
            <table class="table" style="width: 600px;">
                <thead>
                    <tr>
                    <th scope="col">Расстояние между двумя последними точками</th>
                    </tr>
                </thead>
                <tbody id="out"></tbody>
            </table>
        </div>
    </body>
    <script>
        var current = 1;

        let prevX = null, prevY = null;
        let beforePrevX = null, beforePrevY = null;

        img.addEventListener('click', function (e) {
            const x = e.offsetX;
            const y = e.offsetY;

            let dist;
            if (prevX === null) {
                dist = '';
            } else {
                const diffX = prevX - x;
                const diffY = prevY - y;
                dist = Math.sqrt(
                Math.pow(diffX, 2) +
                Math.pow(diffY, 2)).toFixed(2);
            }
            beforePrevX = prevX;
            beforePrevY = prevY;
            prevX =e.offsetX + x;
            prevY = e.offsetY + y;

            var point1 = document.getElementById("point1");
            var point2 = document.getElementById("point2");

            drawIndex(point1, point2, y, x);

            if (dist != '') {
                showDistance(dist + " px");
            } else {
                showDistance('Отмечена лишь одна точка. Сделайте еще клик')
            }
            
        });

        function showDistance(dist) {
            const row = `
            <tr>
            <td>${dist}</td>
            </tr>`;
            table = document.getElementById("out")
            table.innerHTML = row;
        }


        function drawIndex(element1, element2, position1, position2) {
            if (current == 1) {
                drawPoint(element1, position1, position2, 2);
            } else {
                drawPoint(element2, position1, position2, 1);
            }       
        }

        function drawPoint(element, position1, position2, next) {
            current = next;
            element.style.top = position1 - 3 + "px";
            element.style.left = position2 + 12 + "px";
            element.style.visibility = 'visible';
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"></script>
</html>