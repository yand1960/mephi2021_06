<html>
	<head>
		<title>Мой альбом</title>
		<meta charset="utf-8" />
		<link rel="stylesheet" href="styles/main.css" />
		<style>
			div.thumbnails {
				border:solid black thin;
				width: 150px;
				float: left;
			}
			
			div.thumbnails img {
				margin: 5px;
				border-radius: 50%;
				display: block;
				width: 130px;
				border: solid white thick;
			}
			
			div.large-photo {
				float: left;
			}
			
			div.large-photo img {
				width: 398px;
				margin-left: 10px;
			}
			
			div.thumbnails img:hover {
				border: solid red thick;
				cursor: pointer;
			}
			
			div.thumbnails img.selected {
				border: solid blue thick ;
			}

			div.rate {
				border:solid black thin;	
				padding: 10px;
				margin-bottom: 10px;
				width: 540px;
			}
		</style>
		<script src="scripts/jquery-3.6.0.js"></script>
		<script>
			function showLarge(thumb) {
				console.log(thumb);
				var pic_name = thumb.src;
				console.log(pic_name);
				var splitted = pic_name.split(".jpg")
				var large_name = splitted[0] + "-large.jpg";
				console.log(large_name);

				$("#large_photo").attr("src", large_name);
				$("div.thumbnails img").removeClass("selected");
				$(thumb).addClass("selected");
			}

				function getImages() {
					var url = "api/image_service.php";
					var xhr = new XMLHttpRequest();
					xhr.open("GET", url);
					xhr.onload = function() {
						let result = xhr.responseText;
						// console.log(result);
						let images = JSON.parse(result);
						let out="";
						for(pic of images) {
							// console.log(pic.url);
							out += `<img src="${pic.url}"onclick="showLarge(this);"/>`;
						}
						document.getElementById("thumbnails").innerHTML = out;
						var splitted = images[0].url.split(".jpg");
						var large_name = splitted[0] + "-large.jpg";

						document.getElementById("large_photo").src = large_name;
						document.getElementById("large_photo").style.display = "";
						
					};
					xhr.send();
				}

				function getData() {
					var url = "https://www.cbr-xml-daily.ru/daily_json.js";
					var xhr = new XMLHttpRequest();
					xhr.open("GET", url);
					xhr.onload = function() {
						let result = JSON.parse(xhr.responseText);
						var rates = ["USD", "EUR", "GBP"];
						// console.log(result.Valute["AMD"].CharCode)
						// console.log(rates[0]);
						// console.log(Object.keys(result.Valute).length);
						let out="Данные по курсу: <br>";
						for (i = 0; i < rates.length; i++) {
							try {
							out += `<span> ${result.Valute[rates[i]].Nominal} 
											${result.Valute[rates[i]].Name} = 
											${result.Valute[rates[i]].Value} руб.
								<br></span>`;
							}
							catch {
								out += `<span> ${rates[i]} - нет данных <br></span>`
							}		
						}	
						document.getElementById("rate").innerHTML = out;	
					};
					xhr.send();
				}

		
		</script>
	</head>
	<body onload="getImages(); getData();">
		<h1>Фотоальбом Web API</h1>
		<div class="rate" id="rate">Загрузка данных по курсу</div>
		<div class="thumbnails" id="thumbnails">Идет загрузка...</div>		
		<div class="large-photo" >
			<img src="images/april-meyer.jpg" id="large_photo" style="display: none;"/>
		<div>
	</body>
</html>